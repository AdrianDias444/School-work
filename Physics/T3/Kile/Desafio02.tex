%
%% UTF-8       UTF-8      UTF-8       UTF-8       UTF-8       UTF-8
%% UTF-8       UTF-8      UTF-8       UTF-8       UTF-8       UTF-8
%%
%% XeLaTeX  XeLaTeX  XeLaTeX  XeLaTeX  XeLaTeX  XeLaTeX  XeLaTeX  XeLaTeX  

% !TeX program = xelatex
\lccode`\-=`\-
\documentclass[12pt,a4paper,oneside]{extarticle}
\input{auxiliares/preambulo} % não é para alterar

% Pacotes necessários
\usepackage{graphicx}
\usepackage{listings}
\usepackage{needspace}
\usepackage{afterpage}
\usepackage{float}
\usepackage{caption}
\usepackage{wrapfig}
\usepackage{xcolor}
\usepackage{microtype} % Corrige underfull hboxes e melhora justificação

% Configuração do listings
\lstset{
    language=Python,
    basicstyle=\ttfamily\small,
    keywordstyle=\color{blue},
    stringstyle=\color{red},
    commentstyle=\color{gray},
    numbers=left,
    numberstyle=\tiny,
    stepnumber=1,
    showstringspaces=false,
    frame=single,
    breaklines=true,
    captionpos=b,
    backgroundcolor=\color{gray!5}
}

\begin{document}
\input{auxiliares/cabecalho}

\begin{abstract}
Este trabalho apresenta a modelação e visualização 3D da topografia da região metropolitana do Rio de Janeiro utilizando \texttt{Python} e a biblioteca \texttt{PyGMT}. O foco recai sobre a aplicação precisa do sistema de coordenadas \textbf{WGS 84} e da \textbf{perspectiva azimutal} para gerar um mapa topográfico tridimensional com resolução de 30 metros. A implementação combina dados SRTM, sombreamento hipsométrico, curvas de nível e elementos cartográficos, produzindo uma representação visualmente rica e tecnicamente rigorosa.
\end{abstract}

\section{Introdução}

O presente trabalho visa desenvolver uma visualização tridimensional realista da topografia da região metropolitana do Rio de Janeiro, integrando conceitos fundamentais de geodésia e cartografia computacional. Para tal, dois pilares técnicos são fundamentais: o sistema de coordenadas WGS 84, que assegura a precisão posicional, e a perspectiva azimutal, que optimiza a percepção visual do relevo. Estes elementos são aplicados num script em Python com a biblioteca PyGMT.

\section{Conceitos Fundamentais}


\subsection{Dados SRTM}

O \textbf{SRTM} (\textit{Shuttle Radar Topography Mission}) é um conjunto de dados de elevação da superfície terrestre obtido em 2000 pela NASA e pela NGA durante uma missão espacial \textit{Endeavour}. Utilizando radar, mediu a altura do terreno em quase toda a área entre 60° N e 56° S, com uma célula de aproximadamente 30 metros de lado — ou seja, cada ponto representa a altitude média de uma área de 30 × 30 metros.

No presente trabalho, esses dados são carregados directamente com o comando \texttt{pygmt.datasets.load\_earth\_relief(resolution="01s")}, fornecendo a base altimétrica para a construção do modelo 3D do relevo da região metropolitana do Rio de Janeiro.

No script, a grelha SRTM é carregada com:

\begin{lstlisting}
grid = pygmt.datasets.load_earth_relief(resolution="01s", region=region)
\end{lstlisting}

Esta função garante que os dados estejam correctamente georreferenciados em WGS 84, base para toda a análise topográfica.

\subsection{O Sistema de Coordenadas WGS 84}

O \textbf{World Geodetic System 1984 (WGS 84)} constitui o referencial geocêntrico padrão adoptado globalmente, com origem no centro de massa da Terra e eixos alinhados ao \textit{International Earth Rotation and Reference Systems Service} (IERS). Este sistema, definido em detalhe por \cite{f1}, especifica:

\begin{itemize}
    \item \textbf{Eixo Z}: alinhado ao polo de referência IERS (IRP), apontando para o norte.
    \item \textbf{Eixo X}: intersecção do meridiano de referência IERS (IRM) com o plano equatorial, definindo o meridiano principal.
    \item \textbf{Eixo Y}: completa o sistema ortogonal à direita, formando um sistema cartesiano direito.
\end{itemize}

\begin{figure}[H]
\centering
\includegraphics[width=0.8\linewidth]{figuras/imagem3.png}
\caption{Esquema do sistema de coordenadas WGS 84, com eixos X, Y, Z e referências IERS.}
\label{fig:wgs84}
\end{figure}

No script, a região de estudo é delimitada em coordenadas WGS 84:

\begin{lstlisting}
region = [-43.35, -43.05, -23.05, -22.83]  # longitude, latitude em graus
\end{lstlisting}

\subsection{Perspectiva Azimutal em Visualização 3D}

A \textbf{perspectiva azimutal} é definida por dois ângulos principais em visualizações cartográficas 3D:

\begin{itemize}
    \item \textbf{Azimute}: direcção horizontal da câmara (135° — sudeste).
    \item \textbf{Elevação}: ângulo vertical acima do horizonte (30°).
\end{itemize}

Configurada via:

\begin{lstlisting}
perspective = [135, 30]
\end{lstlisting}

Esta escolha maximiza o contraste de sombreamento e destaca feições como o Corcovado. A técnica de visualização 3D com perspectiva é exemplificada em \cite{f3}, que demonstra renderização com sombreamento e contornos.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{figuras/imagem1.png}
\caption{Exemplo de visualização 3D com contornos e mapa 2D ao lado.}
\label{fig:perspectiva_contornos}
\end{figure}

\begin{figure}[H]
\centering
\vspace{-1.5\baselineskip}
\includegraphics[width=0.75\linewidth]{figuras/imagem5.png}
\caption{Exemplo de visualização 3D em perspectiva azimutal de uma região costeira.}
\label{fig:exemplo_perspectiva}
\end{figure}

\subsection{Diferenças entre o Geoide e o Elipsoide no WGS 84}

O modelo WGS 84 utiliza um elipsoide (superfície matemática que aproxima a forma da Terra) como superfície de referência para cálculos geodésicos, mas as elevações reais são frequentemente medidas em relação ao geoide (modelo físico do nível médio do mar) — uma superfície equipotencial que representa o nível médio do mar estendido por baixo dos continentes. A imagem seguinte ilustra as diferenças globais entre o geoide EGM96 e o elipsoide WGS 84, com contornos representando variações em metros.

\begin{figure}[H]
\centering
\includegraphics[width=0.8\linewidth]{figuras/imagem6.png}
\caption{Mapa de contornos do geoide EGM96 referenciado ao elipsoide WGS 84, mostrando variações globais em metros.}
\label{fig:geoide_wgs84}
\end{figure}

Esta representação é crucial para compreender por que razão dados de elevação como o SRTM são ajustados ao geoide: ela corrige as irregularidades gravimétricas da Terra, garantindo que as alturas reflitam o nível do mar real. No contexto do nosso script, esta distinção assegura que as representações 3D sejam não só precisas em coordenadas, mas também em elevações relativas, melhorando a análise topográfica da região do Rio de Janeiro.

\section{Metodologia}

Para alcançar os objectivos propostos, adoptou-se um fluxo de trabalho sistemático que liga os conceitos teóricos à implementação prática, permitindo que o leitor siga o processo passo a passo.

\subsection{Fluxo de Trabalho}

\begin{enumerate}
    \item \textbf{Definição da região}: Utilizando coordenadas no sistema WGS 84 para delimitar a área de estudo.
    \item \textbf{Aquisição da grelha SRTM}: Carregamento de dados de elevação com resolução de 1 segundo de arco (~30 m).
    \item \textbf{Configuração da perspectiva}: Definição do azimute e elevação para uma vista optimizada.
    \item \textbf{Renderização 3D}: Aplicação de sombreamento, curvas de nível e elementos costeiros.
    \item \textbf{Exportação}: Geração de imagem em alta resolução (600 DPI) para análise visual.
\end{enumerate}

Esta sequência garante que cada etapa se baseie na anterior, criando uma cadeia lógica dos dados brutos ao mapa final.

\subsection{Código Python Completo}

O código seguinte implementa o fluxo descrito, servindo como ponte entre a teoria e a prática. Ele é apresentado na íntegra para reprodutibilidade.

\begin{lstlisting}[caption={Script completo de geração do mapa 3D do Rio de Janeiro}, label={lst:script}]
import pygmt

# 1. Região em WGS 84
region = [-43.35, -43.05, -23.05, -22.83]  # ~30x25 km

print("Baixando grelha SRTM 1s (~30m) - pode demorar 30-60s na primeira vez...")
grid = pygmt.datasets.load_earth_relief(
    resolution="01s",
    region=region,
    registration="gridline"
)

# 2. Figura com perspectiva azimutal
fig = pygmt.Figure()
perspective = [135, 30]  # Vista clássica do Rio (sudeste, 30° de elevação)

fig.grdview(
    grid=grid,
    region=region + [0, 3500],
    projection="M18c",
    perspective=perspective,
    frame=["a", "z500f100"],
    zsize="4c",
    surftype="i",
    shading="+a45+nt0.8",
    cmap="geo",
    contourpen="0.3p,gray30"
)

fig.grdcontour(
    grid=grid,
    levels=100,
    annotation="500",
    pen="0.4p,gray10",
    perspective=perspective
)

fig.coast(
    resolution="f",
    shorelines=True,
    water="lightblue@80",
    borders="1/0.6p,gray",
    perspective=perspective
)

fig.colorbar(
    perspective=perspective,
    frame=["a500f100", "x+lElevação (m)", "y+lm"],
    position="JBR+o1c/1c+w14c/0.8c+h"
)

fig.text(
    text="Rio de Janeiro - Topografia 3D (30 m)",
    position="TC",
    font="18p,Helvetica-Bold,white",
    offset="0/0.8c",
    perspective=perspective,
    fill="black@90"
)

fig.savefig("figuras/mapatopografico.png", dpi=600)
print("Mapa 3D salvo como 'mapatopografico.png'")
fig.show()
\end{lstlisting}

\section{Resultados}

O mapa topográfico 3D gerado (\texttt{mapatopografico.png}) representa com alta fidelidade a complexa topografia da região metropolitana do Rio de Janeiro, abrangendo aproximadamente 30 × 25 km, com resolução espacial de 30 metros. A seguir, detalham-se os principais elementos visuais e suas implicações técnicas e cartográficas, conforme princípios estabelecidos pelo USGS para mapas topográficos \cite{f5} e técnicas de sombreamento descritas por Kennelly para realçar o relevo \cite{f4}. Esta análise visa ligar os resultados aos conceitos anteriores, mostrando como cada elemento contribui para uma compreensão clara do terreno.

\subsection{Resolução e Escala de Elevação}

A grelha SRTM de 1 segundo de arco (~30 m) foi renderizada com uma escala vertical (\texttt{zsize="4c"}), permitindo uma percepção clara das variações altimétricas de 0 a 3500 m. A barra de cores (\texttt{cmap="geo"}) utiliza uma paleta hipsométrica que varia de tons azuis (baixas elevações, áreas costeiras e baía de Guanabara) a verdes, amarelos e castanhos (elevações intermédias e altas, como o maciço da Tijuca). Esta escala segue recomendações do USGS para mapas topográficos \cite{f5}, onde cores são associadas a intervalos de altitude para facilitar a leitura. Em termos práticos, isto significa que o leitor pode identificar rapidamente zonas baixas (ex.: praias) e altas (ex.: montanhas), ligando-se à precisão do WGS 84 na definição das coordenadas.

\begin{figure}[H]
\centering
\IfFileExists{figuras/mapatopografico.png}{
    \includegraphics[width=0.95\linewidth]{figuras/mapatopografico.png}
}{
    \fbox{
        \begin{minipage}{0.8\textwidth}
            \centering
            \textbf{ERRO: Imagem mapatopografico.png não encontrada}\\
            Execute \texttt{pythontex Desafio02.tex} para gerar a imagem\\
            O mapa 3D será gerado automaticamente com o script Python
        \end{minipage}
    }
}
\caption{Mapa topográfico 3D do Rio de Janeiro gerado pelo script. Resolução: 30 m; perspectiva: 135°/30°; sombreamento direccional de 45°.}
\label{fig:resultado_final}
\end{figure}

\subsection{Curvas de Nível e Análise Topográfica}

As curvas de nível são traçadas a intervalos de 100 m (\texttt{levels=100}) e anotadas a cada 500 m (\texttt{annotation="500"}), seguindo o padrão cartográfico clássico descrito no documento \textit{Topographic Map Symbols} \cite{f5}. Este intervalo permite:

\begin{itemize}
    \item Análise de gradientes de inclinação: encostas íngremes (ex.: face leste do Corcovado) apresentam curvas mais próximas, enquanto planaltos (ex.: interior da Tijuca) mostram espaçamento maior.
    \item Reconhecimento de formas de relevo: vales fluviais, cristas e depressões são facilmente perceptíveis, ligando-se aos algoritmos de contorno eficientes \cite{f6} que inspiraram a implementação ordenada das curvas.
\end{itemize}

Esta representação facilita a compreensão de como o relevo influencia o ambiente urbano, como o escoamento de águas ou o planeamento de infra-estruturas.

\subsection{Sombreamento Hipsométrico e Iluminação}

O sombreamento direccional (\texttt{shading="+a45+nt0.8"}) simula uma fonte de luz a 45° de azimute e intensidade normalizada de 0.8, conforme técnicas de \textit{hill-shading} descritas por Kennelly \cite{f4}. Este método:

\begin{itemize}
    \item \textbf{Realça micro-relevos}: encostas voltadas para a luz (noroeste) aparecem mais claras, enquanto as opostas (sudeste) ficam sombreadas, criando um efeito de profundidade.
    \item \textbf{Evita artefactos}: o azimute de 45° evita sombras planas em encostas paralelas à luz, um problema comum em iluminações de 0° ou 90°.
    \item \textbf{Combina com a perspectiva}: o ponto de vista de 135°/30° foi escolhido para maximizar o contraste de sombreamento, oferecendo uma visão clássica e informativa do relevo carioca, ligando-se à perspectiva azimutal explicada anteriormente.
\end{itemize}

O resultado é uma imagem que simula uma vista natural, ajudando o leitor a ``sentir'' a tridimensionalidade do terreno.

\subsection{Elementos Cartográficos e Legibilidade}

\begin{itemize}
    \item \textbf{Linha de costa}: renderizada com resolução completa (\texttt{resolution="f"}), em azul claro translúcido (\texttt{water="lightblue@80"}), destacando a interface terra-mar e facilitando a identificação da Baía de Guanabara.
    \item \textbf{Fronteiras administrativas}: traçadas em cinza (\texttt{borders="1/0.6p,gray"}), permitindo contextualização urbana sem sobrecarregar a imagem.
    \item \textbf{Título e legenda}: posicionados de forma não obstrutiva, com fundo semitransparente para legibilidade, garantindo que o mapa seja autoexplicativo.
\end{itemize}

Estes elementos, inspirados em símbolos topográficos padrão \cite{f5}, tornam o mapa acessível, ligando a teoria cartográfica aos resultados práticos.

\section{Geração Automática do Mapa}

O mapa topográfico é gerado automaticamente através do seguinte script Python, que utiliza a biblioteca PyGMT para processar dados SRTM e criar a visualização 3D:

\begin{pycode}
import pygmt
import sys
import os

print("=== INICIANDO GERAÇÃO DO MAPA 3D ===", file=sys.stderr)

try:
    # Garantir que a pasta figuras existe
    os.makedirs("figuras", exist_ok=True)
    
    # 1. Definir região
    region = [-43.35, -43.05, -23.05, -22.83]  # ~30x25 km
    print(f"Região definida: {region}", file=sys.stderr)
    
    # 2. Carregar dados SRTM
    print("Baixando grelha SRTM 1s (~30m)...", file=sys.stderr)
    grid = pygmt.datasets.load_earth_relief(
        resolution="01s", 
        region=region, 
        registration="gridline"
    )
    print("✓ Grelha SRTM carregada com sucesso", file=sys.stderr)
    
    # 3. Criar figura
    fig = pygmt.Figure()
    perspective = [135, 30]  # Vista clássica do Rio
    
    # 4. Configurar visualização 3D
    fig.grdview(
        grid=grid,
        region=region + [0, 3500],
        projection="M18c",
        perspective=perspective,
        frame=["a", "z500f100"],
        zsize="4c",
        surftype="i",
        shading="+a45+nt0.8",
        cmap="geo",
        contourpen="0.3p,gray30",
    )
    
    # 5. Adicionar contornos
    fig.grdcontour(
        grid=grid,
        levels=100,
        annotation="500",
        pen="0.4p,gray10",
        perspective=perspective,
    )
    
    # 6. Adicionar elementos costeiros
    fig.coast(
        resolution="f",
        shorelines=True,
        water="lightblue@80",
        borders="1/0.6p,gray",
        perspective=perspective,
    )
    
    # 7. Adicionar barra de cores
    fig.colorbar(
        perspective=perspective,
        frame=["a500f100", "x+lElevação (m)", "y+lm"],
        position="JBC+o0c/1c+w14c/0.8c+h",
    )
    
    # 8. Adicionar título
    fig.text(
        text="Rio de Janeiro - Topografia 3D (30 m)",
        position="TC",
        font="18p,Helvetica-Bold,white",
        offset="0/0.8c",
        perspective=perspective,
        fill="black@90",
    )
    
    # 9. SALVAR IMAGEM NA PASTA CORRECTA
    output_path = "figuras/mapatopografico.png"
    print(f"Salvando imagem em: {output_path}", file=sys.stderr)
    fig.savefig(output_path, dpi=600)
    
    # 10. Verificar se a imagem foi criada
    if os.path.exists(output_path):
        file_size = os.path.getsize(output_path)
        print(f"✓ IMAGEM GERADA COM SUCESSO: '{output_path}' ({file_size} bytes)", file=sys.stderr)
        print(f"Mapa 3D gerado com sucesso: '{output_path}' (600 DPI)")
    else:
        print(f"✗ ERRO: Imagem não foi criada em {output_path}", file=sys.stderr)
        
except Exception as e:
    print(f"✗ ERRO DURANTE EXECUÇÃO: {e}", file=sys.stderr)
    import traceback
    traceback.print_exc(file=sys.stderr)
\end{pycode}

\section{Conclusão}

\subsection{Síntese da Integração de Conceitos}

A integração bem-sucedida dos conceitos de \textbf{WGS 84}, \textbf{perspectiva azimutal}, \textbf{curvas de nível}, \textbf{sombreamento hipsométrico} e \textbf{algoritmos eficientes para contornos} (conforme \cite{f6}) foi fundamental para a geração de uma visualização topográfica 3D precisa, cientificamente rigorosa e esteticamente clara da região metropolitana do Rio de Janeiro.

\subsection{Precisão Geodésica com WGS 84}

O sistema WGS 84 revelou-se um alicerce de extraordinária robustez para a presente modelação, garantindo que cada feição topográfica do Rio de Janeiro emergisse com fidelidade cartográfica irrepreensível. Ao adoptar este referencial geocêntrico global, o projecto beneficiou de uma coerência posicional que eliminou discrepâncias entre os dados SRTM e a biblioteca PyGMT, permitindo que a delimitação da área de estudo — compreendida entre as coordenadas $[-43.35, -43.05, -23.05, -22.83]$ — se traduzisse directamente em resultados visuais precisos e consistentes.

\subsection{Optimização Visual com Perspectiva Azimutal}

A \textbf{perspectiva azimutal}, configurada como \texttt{[135, 30]} (azimute de 135° a partir do norte, elevação de 30° acima do horizonte), foi estrategicamente escolhida para optimizar a percepção tridimensional do relevo. Este ângulo de visão, combinado com o sombreamento direccional (\texttt{shading="+a45+nt0.8"}), realça feições topográficas icónicas como o Pão de Açúcar e o Corcovado, evitando sombras planas e melhorando a legibilidade das encostas. A técnica de \textbf{hill-shading} discutida por Kennelly \cite{f4} — que varia intensidade luminosa com base em direcção e inclinação — foi implementada de forma computacional, reforçando o contraste entre vales e picos.

\subsection{Precisão Cartográfica com Curvas de Nível}

As \textbf{curvas de nível}, geradas a cada 100 m e anotadas a 500 m, seguem princípios cartográficos consolidados pelo USGS \cite{f5}, representando isolinhas de igual elevação com precisão. Inspirado em algoritmos eficientes para contornos em terrenos triangulados \cite{f6}, o script utiliza \texttt{fig.grdcontour} com ordenação consistente das curvas (sentido horário ou anti-horário), permitindo análise de aninhamento topográfico e identificação de depressões e cumes.

\subsection{Contribuição e Perspectivas Futuras}

Em suma, este trabalho demonstra que a combinação rigorosa de \textbf{geodésia (WGS 84)}, \textbf{cartografia computacional (PyGMT)}, \textbf{algoritmos de contorno}, \textbf{técnicas de sombreamento} e \textbf{princípios de visualização 3D} resulta numa ferramenta poderosa para análise territorial. A abordagem é escalável, reprodutível e prontamente adaptável a outras regiões, constituindo uma contribuição prática e teórica no campo da cartografia digital.

Futuras evoluções incluem:
\begin{itemize}
    \item Animações de rotação azimutais para exploração interactiva.
    \item Integração com dados vectoriais urbanos (ruas, edifícios, transportes).
    \item Aplicação de algoritmos de contorno em tempo real para grandes áreas.
\end{itemize}

\newpage

\nocite{*}  % Garante que TODAS as entradas do .bib aparecem na bibliografia

\printbibliography[title=Referências]
\end{document}
