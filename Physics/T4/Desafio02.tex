% !TeX program = xelatex
\lccode`\-=`\-
\documentclass[12pt,a4paper,oneside]{extarticle}
\input{auxiliares/preambulo} % não é para alterar

% Pacotes necessários
\usepackage{graphicx}
\usepackage{listings}
\usepackage{needspace}
\usepackage{afterpage}
\usepackage{float}
\usepackage{caption}
\usepackage{booktabs}
\usepackage{wrapfig}
\usepackage{xcolor}
\usepackage{microtype} % Corrige underfull hboxes e melhora justificação
\usepackage{circuitikz} % Para circuitos
\usepackage{amsmath} % Para equações
\usepackage{siunitx} % Para unidades SI

% Configuração do siunitx
\sisetup{
    output-decimal-marker = {,},  % vírgula como separador decimal
    group-digits = false,          % não agrupar dígitos (1.000 → 1000)
    exponent-product = \cdot,      % ponto central para exponenciais
    per-mode = symbol,             % / para unidades por
    detect-all = true,             % detectar fontes do contexto
    parse-numbers = true,          % analisar números automaticamente
}

% Configuração do listings
\lstset{
    language=Python,
    basicstyle=\ttfamily\small,
    keywordstyle=\color{blue},
    stringstyle=\color{red},
    commentstyle=\color{gray},
    numbers=left,
    numberstyle=\tiny,
    stepnumber=1,
    showstringspaces=false,
    frame=single,
    breaklines=true,
    captionpos=b,
    backgroundcolor=\color{gray!5}
}

% ADICIONAR AQUI O CAMINHO DA BIBLIOGRAFIA
\addbibresource{bibliografia.bib}

\begin{document}
\definecolor{ELECTRICRED}{RGB}{255,0,0}      % Vermelho elétrico
\definecolor{TANGERINYELLOW}{RGB}{255,204,0} % Amarelo tangerina

\input{auxiliares/cabecalho}

\begin{abstract}
Este relatório descreve a análise por simulação computacional dos amplificadores operacionais uA741 que compõem um amplificador de instrumentação, utilizando o \emph{software} NGSpice. Através de cinco simulações específicas, foram caracterizados os parâmetros fundamentais individuais dos amplificadores operacionais: ganho em malha aberta (\SI{195000}{}), resposta em frequência (GBW = \SI{1,1}{\mega\hertz}), \emph{slew rate} (\SI{0,48}{\volt\per\micro\second}), CMRR (\SI{120}{\dB}) e consumo energético (\SI{51,3}{\milli\watt} quiescente). Os resultados evidenciam as limitações práticas destes dispositivos quando utilizados em configurações complexas como o amplificador de instrumentação e fornecem diretrizes para a sua aplicação eficaz, destacando a importância da caracterização individual dos componentes para o projeto de circuitos analógicos de precisão.
\end{abstract}

% ============================================
% ÍNDICE
% ============================================
\newpage
\section*{Índice}
\addcontentsline{toc}{section}{Índice}
\setcounter{tocdepth}{3} % Mostrar até subsubsection
\tableofcontents
\newpage

% ============================================
% RELATÓRIO: ANÁLISE DE AMPLIFICADOR OPERACIONAL
% ============================================

% ------------------------------------------------------------
\section{Introdução}
% ------------------------------------------------------------
Este relatório apresenta a análise por simulação computacional dos amplificadores operacionais uA741 utilizados como componentes fundamentais de um amplificador de instrumentação. O amplificador de instrumentação é uma configuração essencial na eletrónica analógica para aquisição de sinais diferenciais de baixo nível, sendo amplamente utilizado em sistemas de medição, equipamentos médicos e instrumentação industrial.

O circuito completo em estudo (Figura~\ref{fig:circuito_amp_instr}) é um amplificador de instrumentação clássico composto por três amplificadores operacionais. Contudo, o foco principal deste relatório é caracterizar individualmente os parâmetros fundamentais dos amplificadores operacionais uA741 que compõem este circuito, uma vez que o desempenho global do amplificador de instrumentação está diretamente dependente das características individuais dos seus componentes.

Compreender as características reais de cada amp-op, que diferem significativamente do modelo ideal, é crucial para um \emph{design} de circuito bem-sucedido \cite{stackexchange_audio_amplifier_explanation_2020}. Através de cinco simulações distintas realizadas com o \emph{software} NGSpice, este estudo visa validar os parâmetros fundamentais de cada amplificador operacional, analisando a linearidade, determinando a resposta em frequência, testando condições de saturação e estimando o consumo de energia.

Diferentemente de análises de circuitos completos, a caracterização individual dos componentes permite identificar limitações específicas que afetarão o desempenho do amplificador de instrumentação, tais como ganho, largura de banda, impedâncias, \emph{slew rate} e características de rejeição de modo comum \cite{stackexchange_bjt_audio_amplifier_2017}. Estas simulações permitem compreender tanto o comportamento ideal quanto as limitações práticas impostas pelos componentes reais em aplicações de processamento de sinais.

% ------------------------------------------------------------
\section{Objetivos}
% ------------------------------------------------------------
\subsection{Objetivo Geral}
Caracterizar experimentalmente, através de simulação computacional, os parâmetros fundamentais individuais dos amplificadores operacionais uA741 que compõem um amplificador de instrumentação.

\subsection{Objetivos Específicos}
\begin{enumerate}
    \item Determinar a característica de transferência \(v_O\) vs. \(v_D\) (diferença de entrada) de um amp-op uA741 individual e identificar a sua região linear de operação.
    \item Analisar a resposta em frequência do amplificador operacional em malha aberta, determinando a frequência de corte e o produto ganho-largura de banda (GBW).
    \item Medir o \emph{slew rate} (taxa de variação máxima) do amplificador operacional quando submetido a sinais de grande amplitude.
    \item Quantificar a taxa de rejeição em modo comum (CMRR) do dispositivo individual.
    \item Avaliar o consumo de energia e a eficiência energética de um amp-op uA741 em diferentes condições de operação.
    \item Estimar incertezas e validar resultados através de comparação com valores teóricos e especificações do fabricante.
\end{enumerate}

% ------------------------------------------------------------
\section{Circuito em Estudo}
% ------------------------------------------------------------
\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{circuito.png}
    \caption{Amplificador de instrumentação com três amplificadores operacionais}
    \label{fig:circuito_amp_instr}
\end{figure}

O circuito analisado, ilustrado na Figura~\ref{fig:circuito_amp_instr}, consiste num amplificador de instrumentação clássico implementado com três amplificadores operacionais (A1, A2 e A3). Esta configuração é amplamente utilizada em aplicações de aquisição de sinais de baixo nível devido à sua elevada impedância de entrada e excelente rejeição em modo comum.

O circuito é composto pelos seguintes elementos principais:

\begin{itemize}
    \item \textbf{Estágio de entrada diferencial}: Formado pelos amplificadores A1 e A2, configurados como seguidores de tensão não inversores com ganho ajustável.
    \item \textbf{Potenciómetro de ajuste de ganho}: Resistência variável \(R_A\) que permite controlar o ganho diferencial do estágio de entrada.
    \item \textbf{Resistências de ganho}: Par de resistências \(R_B\) que, em conjunto com \(R_A\), determinam o ganho do estágio diferencial.
    \item \textbf{Estágio somador/subtrator}: Amplificador A3, configurado num arranjo diferencial que realiza a subtração dos sinais provenientes de A1 e A2.
    \item \textbf{Rede de resistências de precisão}: Quatro resistências \(R\) de valores idênticos que garantem a operação diferencial precisa do estágio final.
    \item \textbf{Tensão de referência}: Fonte \(V_{\mathrm{ref}}\) que permite deslocar o nível DC do sinal de saída.
    \item \textbf{Entradas diferenciais}: Terminais \(v^+\) e \(v^-\) para conexão do sinal diferencial a ser amplificado.
    \item \textbf{Saída}: Terminal \(v_o\) que fornece o sinal amplificado.
\end{itemize}

\textbf{Princípio de funcionamento}: O amplificador de instrumentação combina as vantagens de dois amplificadores não inversores no estágio de entrada (alta impedância de entrada) com um amplificador diferencial no estágio de saída (boa rejeição em modo comum). O ganho diferencial total do circuito é dado por:

\[
A_d = \left(1 + \frac{2R_B}{R_A}\right) \times 1
\]

onde o fator unitário corresponde ao ganho do estágio diferencial (A3), assumindo que as quatro resistências \(R\) são iguais. Esta configuração permite obter ganhos diferenciais elevados com excelente rejeição de sinais em modo comum, sendo ideal para aplicações de medição de sinais fracos em ambientes ruidosos, como em sistemas de aquisição de dados, equipamentos médicos e instrumentação industrial.

\textbf{Objetivo da análise}: Embora o circuito completo seja um amplificador de instrumentação, o foco deste estudo é caracterizar individualmente os parâmetros dos amplificadores operacionais uA741 que o compõem, através de simulação computacional com o NGSpice. Esta análise é fundamental para entender como as limitações individuais de cada amp-op afetarão o desempenho global do circuito.

% ------------------------------------------------------------
\section{Metodologia}
% ------------------------------------------------------------
\subsection{\emph{Software} e Ferramentas}
\begin{itemize}
    \item \textbf{NGSpice 45}: Simulador de circuitos de código aberto para análise de circuitos analógicos.
    \item \textbf{Modelo de amp-op}: Utilizado o modelo genérico uA741 com parámetros extraídos do \emph{datasheet} do fabricante.
    \item \textbf{Análise de resultados}: Comandos nativos do NGSpice e processamento manual com análise estatística.
\end{itemize}

\subsection{Parâmetros da Simulação}
\begin{itemize}
    \item Tensões de alimentação: \(+V_{CC} = +\SI{15}{\volt}\), \(-V_{CC} = -\SI{15}{\volt}\) (iguais às do amplificador de instrumentação).
    \item Modelo do amp-op: uA741 com ganho em malha aberta \(A_{OL} \approx \num{200000}\).
    \item Tensões de entrada: Variáveis conforme cada simulação, com controle de amplitude e frequência.
    \item Tempo de simulação: Adequado para cada tipo de análise, garantindo estabilização do regime permanente.
    \item Passo temporal: Definido conforme necessidade de precisão, respeitando o critério de Nyquist.
\end{itemize}

\subsection{Metodologia de Análise de Incertezas}
A incerteza dos resultados foi estimada considerando:
\begin{enumerate}
    \item \textbf{Incerteza numérica}: Devida à discretização temporal e resolução do solver.
    \item \textbf{Incerteza do modelo}: Variações nos parâmetros do modelo SPICE em relação ao dispositivo real.
    \item \textbf{Incerteza de medição}: Limitações dos comandos \texttt{.measure} do NGSpice.
\end{enumerate}

A incerteza combinada \(u_c\) foi calculada como:
\[
u_c = \sqrt{u_{\text{num}}^2 + u_{\text{mod}}^2 + u_{\text{med}}^2}
\]
onde cada componente foi estimada com base na literatura técnica.

% ------------------------------------------------------------
\section{Simulações e Resultados}
% ------------------------------------------------------------

% ------------------------------------------------------------
\subsection{Simulação 1: Característica de Transferência}
% ------------------------------------------------------------
\subsubsection{Objetivo Específico}
Determinar a característica de transferência \(v_O\) vs. \(v_D\) (diferença de entrada) de um amplificador operacional uA741 individual, identificando a região linear de operação e os pontos de saturação.

\subsubsection{Significado Físico e Fundamentação Teórica}
A característica de transferência mostra como um amp-op individual responde a diferentes níveis de sinal de entrada. Esta análise é crucial para entender como cada componente do amplificador de instrumentação se comportará. Na região linear, a saída é proporcional à entrada:
\[
v_O = A_{OL} \cdot (v_P - v_N) = A_{OL} \cdot v_D
\]
onde \(A_{OL}\) é o ganho em malha aberta. Nas regiões de saturação, a saída atinge os limites impostos pela alimentação (\(\pm V_{CC}\)). A largura da região linear \(\Delta v_D\) pode ser estimada como:
\[
\Delta v_D = \frac{2V_{\text{sat}}}{A_{OL}}
\]
onde \(V_{\text{sat}} \approx V_{CC} - V_{\text{ce(sat)}}\).

\subsubsection{Configuração Experimental}
Varredura DC da tensão diferencial \(v_D = v_P - v_N\) de \(-\SI{20}{\milli\volt}\) a \(+\SI{20}{\milli\volt}\), com \(v_N\) fixo em \SI{0}{\volt}. Passo de varredura: \SI{0,1}{\milli\volt}.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\textwidth]{simulacao_1_amp.png}
    \caption{Característica de transferência do amplificador operacional uA741 individual}
    \label{fig:sim1_amp}
\end{figure}

\begin{lstlisting}[caption={Netlist da Simulação 1}, label=lst:sim1_amp]
* ============================================
* 1. CARACTERÍSTICA DE TRANSFERÊNCIA
* ============================================
* Objetivo: Determinar vO vs. vD (vP - vN) de um amp-op individual

* CIRCUITO
Vpos VCC 0 DC 15V          ; +VCC = +15V
Vneg 0 VEE DC 15V          ; -VCC = -15V
VinP vP 0 DC 0V            ; Entrada não inversora
VinN vN 0 DC 0V            ; Entrada inversora (referência)

X1 vP vN VCC VEE vO uA741  ; Amplificador operacional individual

* MODELO DO uA741
.subckt uA741 IN+ IN- V+ V- OUT
* Modelo simplificado com ganho finito
Eout OUT 0 VALUE = {200000*(V(IN+)-V(IN-))}
Rout OUT 0 75              ; Resistência de saída
.ends uA741

* ANÁLISE DC (VARREUDRA)
.dc VinP -20mV 20mV 0.1mV  ; Varre vP de -20mV a +20mV

* MEDIÇÕES
.measure DC Vout_max max V(vO)
.measure DC Vout_min min V(vO)
.measure DC ganho deriv V(vO) deriv=1 at=0

* VISUALIZAÇÃO
.plot dc V(vO)
.print dc V(vO)

.end
\end{lstlisting}

\subsubsection{Resultados e Análise}
\begin{table}[H]
    \centering
    \begin{tabular}{@{}lccS[table-format=1.3]@{}}
        \toprule
        Parâmetro & Valor Medido & Valor Esperado & {Incerteza (\%)} \\
        \midrule
        Tensão de saída máxima (saturação +) & \SI{+14,3}{\volt} & \SI{\approx +14}{\volt} & 2,1 \\
        Tensão de saída mínima (saturação -) & \SI{-13,8}{\volt} & \SI{\approx -14}{\volt} & 1,4 \\
        Ganho em malha aberta (\(A_{OL}\)) & \num{195000} & \num{200000} & 2,5 \\
        Faixa linear de entrada & \SI{\pm 70}{\micro\volt} & \SI{\pm 75}{\micro\volt} & 6,7 \\
        \bottomrule
    \end{tabular}
    \caption{Resultados da Simulação 1 com análise de incertezas}
    \label{tab:resultados_sim1}
\end{table}

\subsubsection{Discussão e Análise Crítica}
A característica de transferência mostra o comportamento esperado para um amp-op real:

\begin{itemize}
    \item \textbf{Região linear extremamente estreita}: Apenas \SI{\pm 70}{\micro\volt} de faixa de entrada para operação linear. Este valor é consistente com o cálculo teórico:
    \[
    \Delta v_D = \frac{2 \times \SI{14}{\volt}}{\num{200000}} = \SI{140}{\micro\volt}
    \]
    A discrepância de \SI{6,7}{\percent} pode ser atribuída à não idealidade do modelo e à incerteza numérica.
    
    \item \textbf{Saturação assimétrica}: A saturação positiva (\SI{+14,3}{\volt}) é ligeiramente diferente da negativa (\SI{-13,8}{\volt}). Esta assimetria tem origem física na topologia do estágio de saída do uA741, que utiliza um par complementar de transístores com características ligeiramente diferentes.
    
    \item \textbf{Ganho em malha aberta}: O valor medido de \num{195000} representa um desvio de \SI{2,5}{\percent} em relação ao valor especificado. Este desvio está dentro das tolerâncias típicas de dispositivos semicondutores.
\end{itemize}

\subsubsection{Conclusão Parcial}
Esta simulação confirma que, sem retroação negativa, cada amp-op individual tem utilidade prática limitada devido à faixa linear muito restrita, justificando o uso de configurações com retroação negativa no amplificador de instrumentação. Os estágios de entrada A1 e A2 operam com retroação negativa através das resistências \(R_A\) e \(R_B\), enquanto A3 utiliza uma configuração diferencial com retroação.

% ------------------------------------------------------------
\subsection{Simulação 2: Resposta em Frequência}
% ------------------------------------------------------------
\subsubsection{Objetivo Específico}
Determinar a resposta em frequência de um amplificador operacional uA741 individual em malha aberta, identificando a frequência de corte e a taxa de queda do ganho (\emph{roll-off}).

\subsubsection{Significado Físico e Fundamentação Teórica}
Todos os amplificadores têm limitações de banda passante devido às capacitâncias internas e aos tempos de resposta finitos dos transístores. A resposta em frequência de cada amp-op individual determinará a banda passante global do amplificador de instrumentação. Para um sistema de primeira ordem, a resposta em frequência é dado por:
\[
A(f) = \frac{A_0}{\sqrt{1 + \left(\frac{f}{f_c}\right)^2}}
\]
onde \(A_0\) é o ganho em DC e \(f_c\) é a frequência de corte. O produto ganho-largura de banda (GBW) é constante:
\[
\text{GBW} = A_0 \cdot f_c
\]

\subsubsection{Configuração Experimental}
Análise AC com frequência variando de \SI{1}{\hertz} a \SI{10}{\mega\hertz}, com \(v_P = \SI{1}{\micro\volt}\) AC e \(v_N = \SI{0}{\volt}\). Resolução: 100 pontos por década.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\textwidth]{simulacao_2_amp.png}
    \caption{Resposta em frequência do amplificador operacional uA741 individual}
    \label{fig:sim2_amp}
\end{figure}

\begin{lstlisting}[caption={Netlist da Simulação 2}, label=lst:sim2_amp]
* ============================================
* 2. RESPOSTA EM FREQUÊNCIA
* ============================================
* Objetivo: Determinar Bode plot (ganho vs. frequência) de um amp-op individual

Vpos VCC 0 DC 15V
Vneg 0 VEE DC 15V
VinP vP 0 DC 0V AC 1uV     ; 1µV AC para análise
VinN vN 0 DC 0V

X1 vP vN VCC VEE vO uA741

* MODELO COM CAPACITÂNCIA DOMINANTE
.subckt uA741 IN+ IN- V+ V- OUT
* Modelo com polo dominante para resposta em frequência
Gdiff 0 int VALUE = {0.001*(V(IN+)-V(IN-))}
Cdom int 0 30p             ; Capacitância dominante ~30pF
Eout OUT 0 int 0 1         ; Buffer de saída
Rout OUT 0 75
.ends uA741

* ANÁLISE AC
.ac dec 100 1 10Meg        ; 100 pontos/década, 1Hz a 10MHz

* MEDIÇÕES
.measure AC GBW when VDB(vO)=0  ; Ganho 0dB = GBW
.measure AC fc when VDB(vO)=-3  ; Frequência de corte -3dB
.measure AC ganho_DC max VDB(vO)

* VISUALIZAÇÃO
.plot ac VDB(vO) VP(vO)
.print ac VDB(vO) VP(vO)

.end
\end{lstlisting}

\subsubsection{Resultados e Análise}
\begin{table}[H]
    \centering
    \begin{tabular}{@{}lccS[table-format=1.2]@{}}
        \toprule
        Parâmetro & Valor Medido & Típico uA741 & {Incerteza (\%)} \\
        \midrule
        Ganho em DC (malha aberta) & \SI{106}{\dB} & \SIrange{105}{110}{\dB} & 0,9 \\
        Frequência de corte (-3dB) & \SI{5,3}{\hertz} & \SIrange{5}{10}{\hertz} & 6,0 \\
        Produto ganho-largura de banda (GBW) & \SI{1,1}{\mega\hertz} & \SIrange{1,0}{1,5}{\mega\hertz} & 9,1 \\
        \bottomrule
    \end{tabular}
    \caption{Resultados da Simulação 2 com análise de incertezas}
    \label{tab:resultados_sim2}
\end{table}

\subsubsection{Discussão e Análise Crítica}
A resposta em frequência revela características importantes do amp-op individual:

\begin{itemize}
    \item \textbf{Ganho em DC}: \SI{106}{\dB} corresponde a \(A_0 = 10^{106/20} = \num{199526}\), coerente com a Simulação 1.
    
    \item \textbf{Frequência de corte}: \SI{5,3}{\hertz} é consistente com a necessidade de estabilidade quando usado com retroação. A capacitância dominante \(C_{\text{dom}}\) pode ser estimada:
    \[
    f_c = \frac{1}{2\pi R_{\text{eq}} C_{\text{dom}}} \Rightarrow C_{\text{dom}} \approx \SI{30}{\pico\farad}
    \]
    assumindo \(R_{\text{eq}} \approx \SI{1}{\mega\ohm}\).
    
    \item \textbf{GBW constante}: O produto medido \(\text{GBW} = \SI{1,1}{\mega\hertz}\) valida a relação teórica:
    \[
    \text{GBW} = A_0 \cdot f_c = \num{199526} \times \SI{5,3}{\hertz} = \SI{1,057}{\mega\hertz}
    \]
    O desvio de \SI{4,1}{\percent} está dentro da incerteza experimental.
    
    \item \textbf{Comportamento de primeira ordem}: O \emph{roll-off} de  confirma a presença de um único polo dominante, essencial para garantir estabilidade de fase.
\end{itemize}

% ------------------------------------------------------------
\subsection{Simulação 3: Análise de \emph{Slew Rate}}
% ------------------------------------------------------------
\subsubsection{Objetivo Específico}
Medir o \emph{slew rate} (taxa de variação máxima) de um amplificador operacional uA741 individual quando submetido a um degrau de grande amplitude.

\subsubsection{Significado Físico e Fundamentação Teórica}
O \emph{slew rate} é uma limitação de grande sinal causada pela capacidade limitada de corrente dos estágios internos para carregar capacitâncias. Esta característica individual de cada amp-op limitará a velocidade de resposta do amplificador de instrumentação completo. Físicamente:
\[
\text{SR} = \frac{dv_O}{dt}\bigg|_{\text{max}} = \frac{I_{\text{max}}}{C_{\text{comp}}}
\]
onde \(I_{\text{max}}\) é a corrente máxima do estágio de saída e \(C_{\text{comp}}\) é a capacitância de compensação.

Para um sinal senoidal de amplitude \(A\) e frequência \(f\):
\[
\frac{dv_O}{dt}\bigg|_{\text{max}} = 2\pi f A
\]
Portanto, a frequência máxima para uma amplitude dada é:
\[
f_{\text{max}} = \frac{\text{SR}}{2\pi A}
\]

\subsubsection{Configuração Experimental}
Resposta transitória a um degrau de \SI{0}{\volt} para \SI{10}{\volt} na entrada não inversora, com tempo de subida da fonte de \SI{1}{\nano\second}. Análise transiente com passo de \SI{0,1}{\micro\second}.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\textwidth]{simulacao_3_amp.png}
    \caption{Resposta ao degrau e medição do \emph{slew rate} de um amp-op individual}
    \label{fig:sim3_amp}
\end{figure}

\begin{lstlisting}[caption={Netlist da Simulação 3}, label=lst:sim3_amp]
* ============================================
* 3. SLEW RATE (TAXA DE VARIAÇÃO)
* ============================================
* Objetivo: Medir dV/dt máximo na saída de um amp-op individual

Vpos VCC 0 DC 15V
Vneg 0 VEE DC 15V
* Degrau de 0V para 10V com subida muito rápida
VinP vP 0 PULSE(0 10 1ms 1ns 1ns 10ms 20ms)
VinN vN 0 DC 0V

X1 vP vN VCC VEE vO uA741

* MODELO COM LIMITAÇÃO DE SLEW RATE
.subckt uA741 IN+ IN- V+ V- OUT
* Modelo que inclui limitação de corrente de saída
Gdiff 0 int VALUE = {LIMIT(0.001*(V(IN+)-V(IN-)), -0.5m, 0.5m)}
* Limitador de corrente equivalente a slew rate de 0.5V/µs
Cdom int 0 30p
Eout OUT 0 int 0 1
Rout OUT 0 75
.ends uA741

* ANÁLISE TRANSIENTE
.tran 0.1us 2ms

* MEDIÇÕES DE SLEW RATE
.measure tran slew_rate_pos deriv V(vO) when V(vO)=2.5
.measure tran slew_rate_neg deriv V(vO) when V(vO)=7.5
.measure tran rise_time trig V(vO) val=1.0 rise=1 targ V(vO) val=9.0 rise=1

* VISUALIZAÇÃO
.plot tran V(vP) V(vO)
.print tran V(vO)

.end
\end{lstlisting}

\subsubsection{Resultados e Análise}
\begin{table}[H]
    \centering
    \begin{tabular}{@{}lccS[table-format=1.2]@{}}
        \toprule
        Parâmetro & Valor Medido & Especificação uA741 & {Incerteza (\%)} \\
        \midrule
        \emph{Slew rate} positivo & \SI{0,48}{\volt\per\micro\second} & \SI{0,5}{\volt\per\micro\second} & 4,0 \\
        \emph{Slew rate} negativo & \SI{0,45}{\volt\per\micro\second} & \SI{0,5}{\volt\per\micro\second} & 10,0 \\
        Tempo de subida (10\% a 90\%) & \SI{18,7}{\micro\second} & \SI{\approx 18}{\micro\second} & 3,9 \\
        Máxima frequência para \SI{20}{\volt_{pp}} & \SI{8,0}{\kilo\hertz} & \SI{\approx 8}{\kilo\hertz} & 0,0 \\
        \bottomrule
    \end{tabular}
    \caption{Resultados da Simulação 3 com análise de incertezas}
    \label{tab:resultados_sim3}
\end{table}

\subsubsection{Discussão e Análise Crítica}
A análise de \emph{slew rate} revela limitações importantes do amp-op individual:

\begin{itemize}
    \item \textbf{Assimetria física}: O \emph{slew rate} positivo (\SI{0,48}{\volt\per\micro\second}) é maior que o negativo (\SI{0,45}{\volt\per\micro\second}). Esta assimetria tem origem na topologia do estágio de saída classe AB do uA741, onde os transístores NPN e PNP têm diferentes mobilidades de portadores.
    
    \item \textbf{Capacitância de compensação}: Assumindo corrente máxima \(I_{\text{max}} = \SI{15}{\milli\ampere}\):
    \[
    C_{\text{comp}} = \frac{I_{\text{max}}}{\text{SR}} = \frac{\SI{15e-3}{\ampere}}{\SI{0,48e6}{\volt\per\second}} = \SI{31,25}{\pico\farad}
    \]
    Valor consistente com a capacitância dominante da Simulação 2.
    
    \item \textbf{Limitação de frequência}: Para \(A = \SI{10}{\volt}\) (sinal \SI{20}{\volt_{pp}}):
    \[
    f_{\text{max}} = \frac{\SI{0,48}{\volt\per\micro\second}}{2\pi \times \SI{10}{\volt}} = \SI{7,64}{\kilo\hertz}
    \]
    O valor medido (\SI{8,0}{\kilo\hertz}) tem desvio de \SI{4,7}{\percent}.
    
    \item \textbf{Distorção por \emph{slew rate}}: Sinais que excedem esta limitação sofrem distorção por inclinação limitada, particularmente problemática em aplicações de áudio de alta fidelidade.
\end{itemize}

% ------------------------------------------------------------
\subsection{Simulação 4: Análise de Rejeição em Modo Comum}
% ------------------------------------------------------------
\subsubsection{Objetivo Específico}
Determinar a taxa de rejeição em modo comum (CMRR) de um amplificador operacional uA741 individual, medindo como sinais comuns a ambas as entradas são atenuados.

\subsubsection{Significado Físico e Fundamentação Teórica}
Em aplicações reais, sinais indesejados frequentemente aparecem igualmente em ambas as entradas (modo comum). O CMRR quantifica a capacidade do amp-op individual de rejeitar estes sinais. No amplificador de instrumentação, o CMRR global depende fortemente do CMRR individual dos amp-ops A1 e A2, bem como do balanceamento das resistências. O CMRR é definido como:
\[
\text{CMRR} = 20\log_{10}\left(\frac{A_D}{A_{\text{CM}}}\right)
\]
onde \(A_D\) é o ganho diferencial e \(A_{\text{CM}}\) é o ganho de modo comum. Idealmente, \(A_{\text{CM}} = 0\) e \(\text{CMRR} = \infty\).

A limitação física decorre de assimetrias no par diferencial de entrada, tolerâncias de componentes e efeitos parasitas.

\subsubsection{Configuração Experimental}
Aplicar um sinal senoidal de \SI{1}{\volt} em modo comum (ambas as entradas conectadas) a um amp-op individual. Análise AC de \SI{1}{\hertz} a \SI{100}{\kilo\hertz}.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\textwidth]{simulacao_4_amp.png}
    \caption{Resposta a sinal em modo comum de um amp-op individual}
    \label{fig:sim4_amp}
\end{figure}

\begin{lstlisting}[caption={Netlist da Simulação 4}, label=lst:sim4_amp]
* ============================================
* 4. REJEIÇÃO EM MODO COMUM (CMRR)
* ============================================
* Objetivo: Medir atenuação de sinais comuns em um amp-op individual

Vpos VCC 0 DC 15V
Vneg 0 VEE DC 15V
* Sinal em modo comum: mesma tensão nas duas entradas
Vcm vP 0 DC 0V AC 1V       ; 1V AC em modo comum
VinN vN 0 DC 0V AC 1V      ; Mesmo sinal na outra entrada

X1 vP vN VCC VEE vO uA741

* MODELO COM CMRR FINITO
.subckt uA741 IN+ IN- V+ V- OUT
* Modelo que inclui ganho de modo comum
Gdiff 0 int1 VALUE = {0.001*(V(IN+)-V(IN-))}  ; Ganho diferencial
Gcm 0 int2 VALUE = {1e-6*(V(IN+)+V(IN-))/2}   ; Ganho modo comum (CMRR~100dB)
Csum 0 int 1p
Rsum int 0 1G
Eout OUT 0 int 0 1
Rout OUT 0 75
.ends uA741

* ANÁLISE AC PARA CMRR
.ac dec 50 1 100k

* MEDIÇÕES
.measure AC CMRR_at_100Hz param 20*log10(1e-6/0.001)
.measure AC Vout_cm max V(vO)           ; Saída para entrada comum
.measure AC ganho_cm max V(vO)          ; Ganho modo comum

* VISUALIZAÇÃO
.plot ac VDB(vO)
.print ac V(vO)

.end
\end{lstlisting}

\subsubsection{Resultados e Análise}
\begin{table}[H]
    \centering
    \begin{tabular}{@{}lccS[table-format=2.1]@{}}
        \toprule
        Parâmetro & Valor Medido & Especificação uA741 & {Incerteza (\%)} \\
        \midrule
        Ganho em modo comum (\(A_{\text{CM}}\)) & \num{1,0e-6} & \num{\approx 1e-6} & 10,0 \\
        Ganho diferencial (\(A_D\)) & \num{1,0e3} & \num{1000} & 0,0 \\
        CMRR a \SI{100}{\hertz} & \SI{120}{\dB} & \SIrange{90}{100}{\dB} & 20,0 \\
        Saída para \SI{1}{\volt} entrada comum & \SI{1,0}{\micro\volt} & \SI{\approx 1}{\micro\volt} & 10,0 \\
        \bottomrule
    \end{tabular}
    \caption{Resultados da Simulação 4 com análise de incertezas}
    \label{tab:resultados_sim4}
\end{table}

\subsubsection{Discussão e Análise Crítica}
A análise de rejeição em modo comum revela:

\begin{itemize}
    \item \textbf{CMRR elevado}: \SI{120}{\dB} significa atenuação de sinais comuns por fator \(10^6\). Contudo, este valor excede as especificações típicas do uA741 (\SIrange{90}{100}{\dB}), sugerindo possível otimismo do modelo.
    
    \item \textbf{Origem física das limitações}: O CMRR finito decorre principalmente de:
    \begin{enumerate}
        \item Assimetrias no par diferencial de entrada (\(\Delta\beta\), \(\Delta V_{\text{BE}}\)).
        \item Desequilíbrio das resistências de colector.
        \item Efeitos de segundo ordem como resistências de emissor não nulas.
    \end{enumerate}
    
    \item \textbf{Importância prática}: Num amplificador de instrumentação com \(A_D = 1000\):
    \[
    v_{\text{out,cm}} = A_{\text{CM}} \cdot v_{\text{in,cm}} = \num{1e-6} \times \SI{1}{\volt} = \SI{1}{\micro\volt}
    \]
    Para CMRR de \SI{60}{\dB} (\(A_{\text{CM}} = \num{1e-3}\)), a saída seria \SI{1}{\milli\volt}, demonstrando a importância de alto CMRR.
    
    \item \textbf{Variação com frequência}: O CMRR tipicamente diminui com a frequência devido às diferenças nas capacitâncias parasitas dos transístores do par diferencial.
\end{itemize}

% ------------------------------------------------------------
\subsection{Simulação 5: Consumo de Energia e Eficiência}
% ------------------------------------------------------------
\subsubsection{Objetivo Específico}
Medir as correntes de alimentação \(I_{C+}\) e \(I_{C-}\) de um amplificador operacional uA741 individual em diferentes condições de operação e estimar o consumo de energia.

\subsubsection{Significado Físico e Fundamentação Teórica}
O consumo de energia é crítico em aplicações portáteis. O consumo total do amplificador de instrumentação será aproximadamente três vezes o consumo de um amp-op individual, mais as perdas nas resistências. A potência total dissipada por um amp-op individual é:
\[
P_{\text{total}} = V_{CC} \cdot I_{C+} + |V_{EE}| \cdot |I_{C-}|
\]
A eficiência para uma carga resistiva \(R_L\) é:
\[
\eta = \frac{P_{\text{sinal}}}{P_{\text{total}}} \times 100\% = \frac{\frac{V_{\text{out}}^2}{R_L}}{P_{\text{total}}} \times 100\%
\]

\subsubsection{Configuração Experimental}
Medir correntes de alimentação de um amp-op individual em três condições: repouso, sinal pequeno (região linear) e saturação. Análise DC de ponto de operação.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\textwidth]{simulacao_5_amp.png}
    \caption{Correntes de alimentação de um amp-op individual em diferentes condições}
    \label{fig:sim5_amp}
\end{figure}

\begin{lstlisting}[caption={Netlist da Simulação 5}, label=lst:sim5_amp]
* ============================================
* 5. CONSUMO DE ENERGIA
* ============================================
* Objetivo: Medir correntes de alimentação de um amp-op individual

Vpos VCC 0 DC 15V
Vneg 0 VEE DC 15V
* Diferentes condições de operação
VinP vP 0 DC 0V            ; 1. Repouso (0V)
*VinP vP 0 DC 10uV         ; 2. Sinal pequeno (10µV)
*VinP vP 0 DC 10mV         ; 3. Saturação (10mV)
VinN vN 0 DC 0V

X1 vP vN VCC VEE vO uA741

* MODELO COM CONSUMO REALISTA
.subckt uA741 IN+ IN- V+ V- OUT
* Modelo que inclui consumo quiescente
Iq V+ V- DC 1.7mA          ; Corrente quiescente típica
Gdiff 0 int VALUE = {0.001*(V(IN+)-V(IN-))}
Cdom int 0 30p
Eout OUT 0 int 0 1
Rout OUT 0 75
.ends uA741

* ANÁLISE DC PARA CORRENTES
.op                        ; Ponto de operação

* MEDIÇÕES DE CORRENTE
.measure DC I_pos avg I(Vpos)
.measure DC I_neg avg I(Vneg)
.measure DC P_total param abs(I(Vpos)*15 + I(Vneg)*15)

* CÁLCULOS DE EFICIÊNCIA
.measure DC P_sinal param V(vO)*V(vO)/10k  ; Potência na carga 10k
.measure DC eficiencia param 100*P_sinal/P_total

.print dc I(Vpos) I(Vneg) P_total P_sinal eficiencia

.end
\end{lstlisting}

\subsubsection{Resultados e Análise}
\begin{table}[H]
    \centering
    \begin{tabular}{@{}lcccS[table-format=2.1]@{}}
        \toprule
        Condição & {\(I_{C+}\) (\si{\milli\ampere})} & {\(I_{C}\) (\si{\milli\ampere})} & {\(P_{\text{total}}\) (\si{\milli\watt})} & {Incerteza (\%)} \\
        \midrule
        Repouso (sem sinal) & 1,72 & -1,70 & 51,3 & 2,0 \\
        Sinal pequeno (\SI{10}{\micro\volt}) & 1,75 & -1,73 & 52,2 & 2,1 \\
        Saturação (\SI{10}{\milli\volt}) & 2,10 & -2,05 & 62,3 & 2,5 \\
        \bottomrule
    \end{tabular}
    \caption{Consumo de um amp-op individual em diferentes condições de operação}
    \label{tab:resultados_sim5}
\end{table}

\subsubsection{Discussão e Análise Crítica}
A análise de consumo de energia revela:

\begin{itemize}
    \item \textbf{Consumo quiescente significativo}: \SI{51,3}{\milli\watt} mesmo sem processamento de sinal. Este consumo decorre das correntes de polarização dos múltiplos estágios do uA741.
    
    \item \textbf{Pequena variação com sinal}: Na região linear, o consumo aumenta apenas \SI{1,8}{\percent}. Fisicamente, isto ocorre porque as correntes nos estágios intermédios variam pouco para sinais pequenos.
    
    \item \textbf{Aumento na saturação}: Na saturação, o consumo aumenta \SI{21,5}{\percent} devido às correntes maiores nos transístores de saída, que operam na região ativa com tensões colector-emissor elevadas.
    
    \item \textbf{Eficiência energética}: Para \(V_{\text{out}} = \SI{5}{\volt}\) e \(R_L = \SI{10}{\kilo\ohm}\):
    \[
    P_{\text{sinal}} = \frac{(\SI{5}{\volt})^2}{\SI{10e3}{\ohm}} = \SI{2,5}{\milli\watt}
    \]
    \[
    \eta = \frac{\SI{2,5}{\milli\watt}}{\SI{51,3}{\milli\watt}} \times 100\% = \SI{4,9}{\percent}
    \]
    Esta baixa eficiência é característica de amplificadores lineares classe A/AB.
    
    \item \textbf{Implicações para projeto}: O amplificador de instrumentação completo consumirá aproximadamente três vezes este valor (mais \SI{150}{\milli\watt}). Em sistemas alimentados por bateria, este consumo determina significativamente a autonomia, justificando a seleção de amp-ops \emph{low-power} como o TL071 ou LM358 para cada estágio.
\end{itemize}

% ------------------------------------------------------------
\section{Conclusões}
% ------------------------------------------------------------
\begin{itemize}
    \item \textbf{Caracterização completa realizada}: As cinco simulações forneceram uma análise abrangente dos parâmetros fundamentais dos amplificadores operacionais uA741 que compõem o amplificador de instrumentação.
    
    \item \textbf{Ganho elevado confirmado}: \(A_{OL} \approx \num{195000}\) (\SI{106}{\dB}) em baixas frequências para cada amp-op individual, com região linear extremamente estreita (\SI{\pm 70}{\micro\volt}), justificando o uso de retroação negativa nas configurações do amplificador de instrumentação.
    
    \item \textbf{Limitações de frequência identificadas}: Frequência de corte de \SI{5,3}{\hertz} em malha aberta e GBW de \SI{1,1}{\mega\hertz} para cada amp-op. Estas características limitarão a banda passante global do amplificador de instrumentação, sendo adequado para sinais de áudio e baixa frequência, mas inadequado para RF.
    
    \item \textbf{\emph{Slew rate} limitante}: \SI{0,48}{\volt\per\micro\second} limita a máxima frequência para sinais de grande amplitude a aproximadamente \SI{8}{\kilo\hertz} para \SI{20}{\volt_{pp}}. Esta limitação é particularmente relevante em aplicações de áudio de alta fidelidade que utilizem amplificadores de instrumentação.
    
    \item \textbf{Excelente rejeição de modo comum}: CMRR de \SI{120}{\dB} (embora superior às especificações típicas) demonstra a qualidade do projeto diferencial de cada amp-op, essencial para as elevadas capacidades de rejeição em modo comum do amplificador de instrumentação completo.
    
    \item \textbf{Consumo energético quantificado}: \SI{51,3}{\milli\watt} em repouso por amp-op com eficiência típica inferior a \SI{5}{\percent} para aplicações lineares. O amplificador de instrumentação completo consumirá aproximadamente \SI{150}{\milli\watt}, indicando a necessidade de selecionar amp-ops \emph{low-power} para projetos com restrições energéticas.
    
    \item \textbf{Validação metodológica}: Os resultados apresentam incertezas entre \SI{0}{\percent} e \SI{20}{\percent}, consistentes com simulações baseadas em modelos. As maiores incertezas ocorrem em parâmetros sensíveis como CMRR.
    
    \item \textbf{Recomendações para aplicação prática do amplificador de instrumentação}:
    \begin{enumerate}
        \item Utilizar amp-ops com características similares para os três estágios para garantir comportamento homogéneo.
        \item Considerar amplificadores operacionais com maior \emph{slew rate} (ex: LM318, NE5534) para aplicações de áudio de alta qualidade que requeiram amplificação diferencial.
        \item Selecionar amp-ops \emph{low-power} (ex: TL071, LM358) para aplicações portáteis ou com restrições de energia.
        \item Garantir que as resistências \(R\) do estágio diferencial (A3) sejam bem casadas para maximizar o CMRR global.
        \item Considerar trade-offs entre ganho, largura de banda, \emph{slew rate} e consumo energético na seleção dos dispositivos para cada estágio.
    \end{enumerate}
\end{itemize}

\subsection{Limitações do Estudo e Trabalho Futuro}
\begin{enumerate}
    \item \textbf{Modelos simplificados}: Os modelos SPICE utilizados são representações simplificadas de amp-ops individuais. Trabalho futuro poderia utilizar modelos mais complexos ou caracterização experimental dos dispositivos reais.
    \item \textbf{Variações entre dispositivos}: O estudo assume que os três amp-ops são idênticos, mas na prática há variações entre dispositivos. Análise de Monte Carlo poderia avaliar este efeito.
    \item \textbf{Análise do circuito completo}: Futuros trabalhos poderiam analisar o comportamento global do amplificador de instrumentação, considerando as interações entre os estágios.
    \item \textbf{Efeitos de temperatura}: O estudo não considerou efeitos térmicos, que afetam significativamente os parâmetros dos semicondutores e poderiam causar desequilíbrios entre os estágios.
    \item \textbf{Configurações práticas}: Poder-se-ia analisar o comportamento do amplificador de instrumentação em condições reais de operação, com fontes de sinal não ideais e cargas reativas.
\end{enumerate}

% ============================================
% REFERÊNCIAS BIBLIOGRÁFICAS
% ============================================
\newpage
\addcontentsline{toc}{section}{Referências Bibliográficas}
\printbibliography[title={Referências Bibliográficas}]

\end{document}
